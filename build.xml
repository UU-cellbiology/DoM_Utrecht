<project name="DoM_" default="" basedir=".">
	
	<description>DoM GPU Fiji plug-in build file</description>
	
	<!-- user configuration -->
	<property name="Fiji" location="/Applications/Fiji.app" />
	<property name="FijiPluginsDir" location="${Fiji}/plugins/" />
	<property name="FijiJarsDir" location="${Fiji}/jars/" />
	
	<!-- directories -->
	<property name="src" location="src" />
	<property name="build" location="bin" />
	<property name="dist" location="dist" />
	<property name="lib" location="lib" />
	
	<!-- manifest properties -->
	<property name="user.name" value="Yevhen Katrukha" />
	
	<!-- java class path -->
	<path id="dom.classpath">
		<fileset dir="${lib}">
			<include name="ij-1.48f.jar" />
			<include name="jaolho.jar" />
			<include name="jocl-0.1.9.jar" />
		</fileset>
	</path>
	<path id="jaolho.classpath">
		<fileset dir="${lib}">
			<include name="jama-1.0.3.jar" />
		</fileset>
	</path>
	
	<!-- main target -->
	<target name="main" depends="build" description="Main target">
		<echo>Building the DoM plug-in</echo>
	</target>
	
	<!-- compile target -->
	<target name="build" depends="compress" description="building DoM">
		<echo>Building DoM plug-in</echo>
	</target>
	
	<!-- compress target -->
	<target name="compress" depends="compile" description="generate JAR-file">
		<echo>Compress class-files into JAR-file</echo>
		<mkdir dir="${dist}" />
		<copy file="${src}/FittingKernelLMA.cl" toDir="${build}" />
		<!--<copy file="${src}/plugins.config" toDir="${build}" />--> <!-- NOTE: not used, not up-to-date! -->
		<jar jarfile="${dist}/DoM_GPU.jar">
			<fileset dir="${build}" includes="DOM/**" />
			<fileset dir="${src}" includes="FittingKernelLMA.cl" />
			<!--<fileset dir="${src}" includes="plugins.config" />-->
			<manifest>
 		 	 	<attribute name="Built-By" value="${user.name}"/>
			</manifest>
		</jar>
	</target>
	
	<!-- compile target -->
	<target name="compile" depends="" description="compiling source code">
		<echo>Compiling source code</echo>
		<mkdir dir="${build}" />
		<javac destdir="${build}" source="1.6" target="1.6" includeantruntime="false">
			<compilerarg value="-Xlint:unchecked" />
			<src path="${src}/DOM" />
			<classpath refid="dom.classpath" />
		</javac>
	</target>
	
	<!-- jaolho target -->
	<target name="jaolho" depends="" description="building jaolho library">
		<echo>Compiling jaolho library</echo>
		<mkdir dir="${build}" />
		<javac destdir="${build}" source="1.6" target="1.6" includeantruntime="false">
			<compilerarg value="-Xlint:unchecked" />
			<src path="${src}/jaolho" />
			<classpath refid="jaolho.classpath" />
		</javac>
		
		<echo>Compress class-files into JAR-file</echo>
		<jar jarfile="${lib}/jaolho.jar">
			<fileset dir="${build}" includes="jaolho/**" />
			<manifest>
 		 	 	<attribute name="Built-By" value="${user.name}"/>
			</manifest>
		</jar>
	</target>
	
	<!-- install target -->
	<target name="install" depends="main" description="generate distribution">
		<copy file="${dist}/DoM_GPU.jar" toDir="${FijiPluginsDir}" />
		<copy file="${lib}/jama-1.0.3.jar" toDir="${FijiJarsDir}" />
		<copy file="${lib}/jaolho.jar" toDir="${FijiJarsDir}" />
		<copy file="${lib}/jocl-0.1.9.jar" toDir="${FijiJarsDir}" />
	</target>
	
	<!-- clean target -->
	<target name="clean" depends="" description="clean build directory">
		<echo>Cleaning build directory</echo>
		<delete includeemptydirs="true">
			<fileset dir="${build}" includes="**" defaultexcludes="no" />
		</delete>
	</target>
	
	<!-- deep clean target -->
	<target name="deep-clean" depends="clean" description="clean distribution directory">
		<echo>Cleaning distribution directory</echo>
		<delete includeemptydirs="true">
			<fileset dir="${dist}" includes="**" defaultexcludes="no" />
			<fileset dir="${lib}" includes="jaolho.jar" />
		</delete>
	</target>
	
</project>
